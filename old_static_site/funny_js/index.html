<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type"
          content="text/html; charset=utf-8">

    <meta name="viewport"
          content="width=device-width, initial-scale=1">

    <link rel="shortcut icon"
          type="image/png"
          href="/_img/adeptus-mechanicus.png">

    <link rel="stylesheet"
          href="/_css/css.css">
    <title>Минутка занимательного яваскрипта | Ohar</title>
    <meta name="description"
          content="Чудесные маленькие находки и большие раздражающие странности в славном JavaScript"/>
</head>
<body>
<header class="header">
    <nav class="menu">
        <ul class="menu_list">
            <li class="menu_list_item">
                <a class="menu_list_item_link menu_list_item_link-img"
                   href="/"
                   title="На главную">
                    <img class="menu_list_item_link_img"
                         src="/_img/logo.png"
                         alt="Adeptus Mechanicus"
                         width="48" height="48">
                </a>
            </li>
            <li class="menu_list_item">
                <a class="menu_list_item_link"
                   href="https://github.com/Ohar/"
                   target="_blank"
                   title="Профиль на GitHub"
                   rel="nofollow">
                    GitHub
                </a>
            </li>
            <li class="menu_list_item">
                <a class="menu_list_item_link"
                   href="/life"
                   title="Поиграть в «Жизнь»">
                    Игра «Жизнь»
                </a>
            </li>
            <li class="menu_list_item">
                <a class="menu_list_item_link"
                   href="/rules"
                   title="Правила оформления текстов на русском языке">
                    Оформлениe текстов
                </a>
            </li>
            <li class="menu_list_item">
                <a class="menu_list_item_link"
                   href="/quotes/#0"
                   title="Всякие цитаты">
                    <span class="icon-quote-left"></span>
                    Цитаты
                </a>
            </li>
            <li class="menu_list_item">
                <a class="menu_list_item_link"
                   href="/names/"
                   title="Славянские, советские и греческие имена из Википедии">
                    Генератор имён
                </a>
            </li>
            <li class="menu_list_item">
                <a class="menu_list_item_link"
                   href="/about/"
                   title="Связаться со мной">
                    <span class="icon-torso"></span>
                    Обо мне
                </a>
            </li>
            <li class="menu_list_item">
                <a class="menu_list_item_link"
                   href="/funny_js/">
                    Минутка занимательного яваскрипта
                </a>
            </li>
        </ul>
    </nav>
</header>
<nav>
    <ul>
        <li>
            <a href="/funny_js/button_title/">
                Невидимый title у детей button </a>
        </li>
        <li>
            <a href="/funny_js/damned_jsx/">
                JSX бьёт по рукам </a>
        </li>
        <li>
            <a href="/funny_js/instanceof/">
                Чудесный <code>instanceof</code> </a>
        </li>
        <li>
            <a href="/funny_js/negative_indexes/">
                Отрицательные индексы </a>
        </li>
        <li>
            <a href="/funny_js/semicolon/">
                Точки с запятой </a>
        </li>
        <li>
            <a href="/funny_js/new_date/">
                Конструктор дат </a>
        </li>
    </ul>
</nav>
<main class="main articles">
    <h1>Минутка занимательного яваскрипта</h1>
    <p>Чудесные маленькие находки и большие раздражающие странности в славном JavaScript</p>
    <article><h1>Невидимый title у детей button</h1>

        <time datetime="2016-12-28">28 декабря 2016 г.</time>

        <h2>Что не так?</h2>

        <p>Невероятно тупой вопрос: <q>Всегда ли отображается атрибут <code>title</code> у видимых html-элементов?</q>
        </p>

        <p>Ответ, ожидаемо: <q>Нет, не всегда</q>. Например, его не хочет отображать Firefox для вложенных в <code>button</code>
            элементов.</p>

        <h3>Пример</h3>

        <h4>Код</h4>
        <p><code>&lt;button&gt;&lt;span title=&quot;bar&quot;&gt;foo&lt;/span&gt;&lt;/button&gt;</code></p>

        <h4>Элемент</h4>
        <p>
            <button><span title="foo">bar</span></button>
        </p>

        <h2>Почему так?</h2>

        <p>А это просто-напросто <a target="_blank" rel="nofollow"
                                    href="https://bugzilla.mozilla.org/show_bug.cgi?id=183113&GoAheadAndLogIn=1">баг</a>,
            открытый ещё в 2002 году.</p>

        <h3>А что говорит спецификация?</h3>

        <blockquote>
            The title attribute represents advisory information for the element, such as would be appropriate for a
            tooltip
            <cite>
                <a href="https://www.w3.org/TR/2011/WD-html5-20110405/elements.html#the-title-attribute"
                   target="_blank"
                   rel="nofollow">W3C</a>
            </cite>
        </blockquote>

        <blockquote>
            The title global attribute contains a text representing advisory information related to the element it
            belongs to. Such information can typically, but not necessarily, be presented to the user as a tooltip.
            <cite>
                <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/title"
                   target="_blank"
                   rel="nofollow">MDN</a>
            </cite>
        </blockquote>

        <p>То есть <code>title</code> — штука справочная и не особо-то и обязательная. Скорее всего поэтому баг и висит
            уже 14 лет.</p>

        <h2>Что же делать?</h2>

        <p>Всё не так плохо, можно нагло заменять <code>title</code> псевдоэлементом. Решение <a target="_blank"
                                                                                                 rel="nofollow"
                                                                                                 href="https://jsfiddle.net/pqrbdjsc/">предложено</a>
            Антоном Немцовым.</p>

        <p>
            <button class="example_fixed_title"><span title="bar">foo</span></button>
        </p>

        <style>
            .example_fixed_title {
                position: relative;
            }

            .example_fixed_title:hover span:before {
                content: attr(title);
                display: block;
                position: absolute;
                background: white;
                bottom: 100%;
                left: 0;
                margin: 0 0 10px;
                padding: 5px 20px;
            }

            .example_fixed_title:hover span:after {
                content: "";
                display: block;
                height: 0;
                width: 0;
                border-width: 5px 5px 0;
                border-style: solid;
                border-color: white transparent transparent;
                position: absolute;
                bottom: 100%;
                margin: 0 0 5px;
            }</style>
    </article>
    <article><h1>JSX бьёт по рукам</h1>

        <time datetime="2016-06-09">9 июня 2016 г.</time>

        <h2>Что не так?</h2>

        <p>Допустим, надо сделать из строки <code>'A,B'</code> разметку </p>

        <code>
<pre>
&lt;i&gt;A&lt;/i&gt;
&lt;b&gt;B&lt;/b&gt;
</pre>
        </code>

        <p>Вы хотите сделать это самым очевидным способом — обработав строку</p>

        <img src="/funny_js/damned_jsx/easy_way.png"
             alt="formatter = input => input.replace('A', <i>A</i>).replace('B', <b>B</b>)"
             width="399"
             height="40">

        <p>Но, вместо лёгкого решения, вы получаете какую-то фигню вроде <code>[object Object],[object Object]</code>.
        </p>

        <h2>Почему так?</h2>

        <p>Мистер JSX только делает вид что HTML в нём — это строки. Это ни капельки не строки, а очень даже
            DOM-объекты. И операции работы со строками, которые вы пытаетесь провести своими грязными ручонками,
            попросту ничего не дадут.</p>

        <p>В лучшем случае вы получите знаменитый <code>[object][Object]</code> вместо желаемой разметки.</p>

        <h2>Что же делать?</h2>

        <p>Ну, как обычно, страдать. Есть неплохой вариант — разбивать строку на массив элементов и каждому из них
            давать свой шаблон и складывать в массив-результат.</p>

        <img src="/funny_js/damned_jsx/hard_way.png"
             alt="formatter = input => {let result = [];input.split(',').forEach(e => {switch (e) {case 'A':result.push(<i>{e}</i>);break;case 'B':result.push(<b>{e}</b>);break;}});return result}"
             width="299"
             height="298">

        <p>М-м-м-м, сколько кода…</p>

        <p>А просто сделать замены в строке, засунув туда HTML — нельзя.</p>
    </article>
    <article><h1>Чудесный <code>instanceof</code></h1>

        <time datetime="2016-04-14">14 апреля 2016 г.</time>

        <h2>Что не так?</h2>

        <code>
<pre>
'foo' instanceof String // false
</pre>
        </code>

        <p>Строка не является экземпляром класса Строка. Чудесно, правда?</p>

        <h2>Почему так?</h2>

        <p>Строка <code>'foo'</code> создаётся через <em>литерал строки</em> — кавычки (<code>''</code>). <strong>Это не
            объект, а примитив</strong>, а у примитива нет прототипа.</p>

        <p>Это относится ко всем примитивам, созданным через литералы — числам, строкам и булям.</p>

        <code>
<pre>
true instanceof Boolean // false
42 instanceof Number // false
</pre>
        </code>

        <p>Но те же числа, строки и були, созданные через <em>конструктор</em> оператором <code>new</code> — очень даже
            <em>являются экземплярами своих классов</em>, потому как конструктор создаёт не примитив, но объект.</p>

        <code>
<pre>
// НИ В КОЕМ СЛУЧАЕ НЕ ПОВТОРЯЙТЕ ЭТОГО ДОМА ИЛИ НА РАБОТЕ
// ЭТО МОЖЕТ ПРИВЕСТИ К САМОВОЛОСОВЫРЫВАНИЮ ИЛИ ПОБИТИЮ КОЛЛЕГАМИ
let foo = new String('bar');
foo instanceof String // true
</pre>
        </code>

        <h2>Что же делать?</h2>

        <p>Ну как обычно, страдать. Но если вам всё равно надо узнать тип переменной, проверяйте, не примитив ли это
            через <code>typeof</code>.</p>

        <p>И только если это не примитив (<code>typeof</code> выдаст <code>'object'</code>), то имеет смысл проверять
            его прототип через <code>instanceof</code>.</p>
    </article>
    <article><h1>Отрицательные индексы</h1>

        <time datetime="2016-03-17">17 марта 2016 г.</time>

        <h2>Что не так?</h2>

        <pre>
<code>let arr = [];
arr[-1] = 'foo'; // В массив записывается элемент с отрицательным индексом
arr; // [] — после этого массив выглядит пустым
arr[-1]; // foo — но это не так</code>
</pre>

        <p>В массив можно записать элемент с отрицательным индексом. При этом его не видно при вызове массива. Но он
            есть. Как суслик.</p>

        <blockquote>
<pre>
… Видишь суслика?
— Нет.
— И я не вижу. А он есть!
</pre>
            <cite>© <a target="_blank" rel="nofollow"
                       href="https://ru.wikiquote.org/wiki/%D0%94%D0%9C%D0%91_%28%D1%84%D0%B8%D0%BB%D1%8C%D0%BC%29">прапорщик
                Казаков, фильм «ДМБ»</a></cite>
        </blockquote>

        <h2>Почему так?</h2>

        <p>Несмотря на то, что индекс — это число, записывать элементы массива можно только по натуральным индексам.
            Попытка записать элемент на какой-либо другой индекс (например, объект, дробное число или отрицательное
            число) вызовёт преобразование индекса к строке и запись не <strong>элемента массива</strong>, а <strong>свойства
                массива</strong> по ключу.</p>

        <p>Поэтому запись проходит успешно, но записывается не элемент, а свойство.</p>

        <h2>Что же делать?</h2>

        <p>
            <del>Молиться, поститься и слушать радио «Радонеж».</del>
            Да особо ничего. Просто при странных действиях не нужно ожидать адекватных результатов.
        </p>
    </article>
    <article><h1>Точки с запятой</h1>

        <time datetime="2016-02-20">20 февраля 2016 г.</time>

        <h2>Что не так?</h2>

        <p>Найдите ошибку в коде, не запуская его</p>

        <pre>
<code>let a = 5

(function() {
  alert(a)
})()</code>
</pre>

        <h2>Почему так?</h2>

        <p><code>TypeError: 5 is not a function</code></p>

        <p>Пропущенная точка с запятой приводит к тому, что самовызываемая функция превращается в аргумент при
            выполнении числа <code>5</code> как функции.</p>

        <p>Это равноценно такой записи</p>

        <pre>
<code>let a = 5(function() {alert(a)})()</code>
</pre>

        <p><code>5</code> — примитив, его нельзя выполнить и из-за этого скрипт умирает.</p>

        <img src="/funny_js/semicolon/wasted.jpg"
             alt="ПОТРАЧЕНО"
             width="400"
             height="240">

        <h3>Корректная запись</h3>

        <pre>
<code>let a = 5;

(function() {
  alert(a)
})();</code>
</pre>


        <h2>Что же делать?</h2>

        <p>Соблюдайте стиль кодирования и всегда ставьте точки с запятой и фигурные скобки.</p>
    </article>
    <article><h1>Конструктор дат</h1>

        <time datetime="2016-02-18">18 февраля 2016 г.</time>

        <h2>Что не так?</h2>

        <pre>
<code>String(new Date(2015, 0)) === String(new Date('2015-01')) // false</code>
</pre>

        <p>Первое января, которое создаётся конструктором <code>new Date</code> из нескольких аргументов не равно
            первому января, созданному конструктором <code>new Date</code> из строки в ISO-формате.</p>


        <h2>Почему так?</h2>

        <p>А что же создаётся в том и другом случае?</p>

        <pre>
<code>
String(new Date(2015, 0))   // "Thu Jan 01 2015 00:00:00 GMT+0300"
String(new Date('2015-01')) // "Thu Jan 01 2015 03:00:00 GMT+0300"
</code>
</pre>

        <p>Ух ты. Смещение часового пояса. Друг мой, а почему ж ты в одном случае учитываешься, а во втором — нет?</p>

        <p>Обратимся к документации, там наверняка есть логичное объяснение.</p>

        <blockquote>
            <p><b>Обратите внимание:</b> если функция <code>Date</code> вызывается в качестве конструктора с более чем
                одним аргументом, то указанные аргументы интерпретируются как локальное время. Если аргументы указывают
                время в <abbr
                        title="Всеми́рное координи́рованное вре́мя (англ. Coordinated Universal Time, фр. Temps Universel Coordonné; UTC)">UTC</abbr>,
                используйте <code>new Date(Date.UTC(...))</code> с теми же аргументами.</p>
            <cite>© <a target="_blank" rel="nofollow"
                       href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Date">MDN</a></cite>
        </blockquote>

        <h3>Иными словами</h3>

        <img src="/funny_js/new_date/prost.jpeg"
             alt="ПРОСТ))00))"
             width="345"
             height="346">

        <h2>Что же делать?</h2>

        <p>Читать документацию, работать с датами только одним из этих способов, либо черёз <a target="_blank"
                                                                                               rel="nofollow"
                                                                                               href="http://momentjs.com/">обёртки</a>.
        </p>
    </article>
</main>
<footer class="footer">

</footer>
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
  (function (d, w, c) {
    (w[c] = w[c] || []).push(function () {
      try {
        w.yaCounter21398491 = new Ya.Metrika({
          id                 : 21398491,
          webvisor           : true,
          clickmap           : true,
          trackLinks         : true,
          accurateTrackBounce: true,
          trackHash          : true,
        })
      } catch (e) { }
    })

    var n   = d.getElementsByTagName('script')[0],
        s   = d.createElement('script'),
        f   = function () { n.parentNode.insertBefore(s, n) }
    s.type  = 'text/javascript'
    s.async = true
    s.src   = (d.location.protocol == 'https:' ? 'https:' : 'http:') + '//mc.yandex.ru/metrika/watch.js'

    if (w.opera == '[object Opera]') {
      d.addEventListener('DOMContentLoaded', f, false)
    } else { f() }
  })(document, window, 'yandex_metrika_callbacks')
</script>
<noscript>
    <div><img src="//mc.yandex.ru/watch/21398491" style="position:absolute; left:-9999px;" alt=""/></div>
</noscript>
<!-- /Yandex.Metrika counter -->    </body>
</html>